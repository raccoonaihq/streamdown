"use client";import{createContext as xe,memo as an,useId as yo,useMemo as sn}from"react";import vo from"react-markdown";import ko from"rehype-katex";import Mo from"rehype-raw";import xo from"remark-gfm";import Co from"remark-math";import"katex/dist/katex.min.css";import{harden as No}from"rehype-harden";import{isValidElement as re,memo as I,useContext as Ye,useState as Gn}from"react";import{CheckIcon as un,CopyIcon as mn,DownloadIcon as pn}from"lucide-react";import{createContext as fn,useContext as le,useEffect as tt,useRef as nt,useState as Be}from"react";import{bundledLanguages as hn,createHighlighter as Qe}from"shiki";import{createJavaScriptRegexEngine as gn}from"shiki/engine/javascript";import{clsx as cn}from"clsx";import{twMerge as dn}from"tailwind-merge";var y=(...e)=>dn(cn(e)),Y=(e,t,n)=>{let o=typeof t=="string"?new Blob([t],{type:n}):t,a=URL.createObjectURL(o),r=document.createElement("a");r.href=a,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},Se=async(e,t=2)=>{let n=e.cloneNode(!0),o=e.getBoundingClientRect(),a=e.getAttribute("viewBox"),r=o.width||e.clientWidth,i=o.height||e.clientHeight;if((!r||!i)&&a){let f=a.split(/\s+|,/).map(Number);f.length===4&&(r=f[2],i=f[3])}r||(r=800),i||(i=600),n.setAttribute("width",`${r}`),n.setAttribute("height",`${i}`),n.getAttribute("viewBox")||n.setAttribute("viewBox",`0 0 ${r} ${i}`),n.hasAttribute("xmlns")||n.setAttribute("xmlns","http://www.w3.org/2000/svg");let l=new XMLSerializer().serializeToString(n),s=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(l)}`,c=new Image;c.src=s,await new Promise((f,h)=>{c.onload=f,c.onerror=w=>{h(new Error(`Failed to load SVG image: ${w}`))}});let d=document.createElement("canvas");d.width=r*t,d.height=i*t;let m=d.getContext("2d");if(!m)throw new Error("Failed to get canvas context");return m.scale(t,t),m.drawImage(c,0,0,r,i),new Promise((f,h)=>{d.toBlob(w=>{w?f(w):h(new Error("Failed to create blob"))},"image/png")})};import{jsx as G,jsxs as Ie}from"react/jsx-runtime";var bn=/<pre(\s|>)/,Ae=fn({code:""}),Le=class{constructor(){this.lightHighlighter=null;this.darkHighlighter=null;this.lightTheme=null;this.darkTheme=null;this.loadedLanguages=new Set;this.initializationPromise=null}isLanguageSupported(t){return Object.hasOwn(hn,t)}getFallbackLanguage(){return"text"}async ensureHighlightersInitialized(t,n){var d,m;let[o,a]=t,r=gn({forgiving:!0}),i=!this.lightHighlighter||this.lightTheme!==o,l=!this.darkHighlighter||this.darkTheme!==a;(i||l)&&this.loadedLanguages.clear();let s=this.isLanguageSupported(n),c=!this.loadedLanguages.has(n)&&s;if(i?(this.lightHighlighter=await Qe({themes:[o],langs:s?[n]:[],engine:r}),this.lightTheme=o,s&&this.loadedLanguages.add(n)):c&&await((d=this.lightHighlighter)==null?void 0:d.loadLanguage(n)),l){let f=c?[...this.loadedLanguages].concat(s?[n]:[]):Array.from(this.loadedLanguages);this.darkHighlighter=await Qe({themes:[a],langs:f.length>0?f:s?[n]:[],engine:r}),this.darkTheme=a}else c&&await((m=this.darkHighlighter)==null?void 0:m.loadLanguage(n));c&&this.loadedLanguages.add(n)}async highlightCode(t,n,o,a){var m,f;this.initializationPromise&&await this.initializationPromise,this.initializationPromise=this.ensureHighlightersInitialized(o,n),await this.initializationPromise,this.initializationPromise=null;let[r,i]=o,l=this.isLanguageSupported(n)?n:this.getFallbackLanguage(),s=(m=this.lightHighlighter)==null?void 0:m.codeToHtml(t,{lang:l,theme:r}),c=(f=this.darkHighlighter)==null?void 0:f.codeToHtml(t,{lang:l,theme:i}),d=h=>!h||!a?h!=null?h:"":h.replace(bn,`<pre class="${a}"$1`);return[d(s),d(c)]}},wn=new Le,ot=({code:e,language:t,className:n,children:o,preClassName:a,...r})=>{let[i,l]=Be(""),[s,c]=Be(""),d=nt(!1),[m,f]=le($e);return tt(()=>(d.current=!0,wn.highlightCode(e,t,[m,f],a).then(([h,w])=>{d.current&&(l(h),c(w))}),()=>{d.current=!1}),[e,t,m,f,a]),G(Ae.Provider,{value:{code:e},children:Ie("div",{className:"my-4 w-full overflow-hidden rounded-xl border","data-code-block-container":!0,"data-language":t,children:[Ie("div",{className:"flex items-center justify-between bg-muted/80 p-3 text-muted-foreground text-xs","data-code-block-header":!0,"data-language":t,children:[G("span",{className:"ml-1 font-mono lowercase",children:t}),G("div",{className:"flex items-center gap-2",children:o})]}),G("div",{className:"w-full",children:Ie("div",{className:"min-w-full",children:[G("div",{className:y("overflow-x-auto dark:hidden",n),dangerouslySetInnerHTML:{__html:i},"data-code-block":!0,"data-language":t,...r}),G("div",{className:y("hidden overflow-x-auto dark:block",n),dangerouslySetInnerHTML:{__html:s},"data-code-block":!0,"data-language":t,...r})]})})]})})},et={"1c":"1c","1c-query":"1cq",abap:"abap","actionscript-3":"as",ada:"ada",adoc:"adoc","angular-html":"html","angular-ts":"ts",apache:"conf",apex:"cls",apl:"apl",applescript:"applescript",ara:"ara",asciidoc:"adoc",asm:"asm",astro:"astro",awk:"awk",ballerina:"bal",bash:"sh",bat:"bat",batch:"bat",be:"be",beancount:"beancount",berry:"berry",bibtex:"bib",bicep:"bicep",blade:"blade.php",bsl:"bsl",c:"c","c#":"cs","c++":"cpp",cadence:"cdc",cairo:"cairo",cdc:"cdc",clarity:"clar",clj:"clj",clojure:"clj","closure-templates":"soy",cmake:"cmake",cmd:"cmd",cobol:"cob",codeowners:"CODEOWNERS",codeql:"ql",coffee:"coffee",coffeescript:"coffee","common-lisp":"lisp",console:"sh",coq:"v",cpp:"cpp",cql:"cql",crystal:"cr",cs:"cs",csharp:"cs",css:"css",csv:"csv",cue:"cue",cypher:"cql",d:"d",dart:"dart",dax:"dax",desktop:"desktop",diff:"diff",docker:"dockerfile",dockerfile:"dockerfile",dotenv:"env","dream-maker":"dm",edge:"edge",elisp:"el",elixir:"ex",elm:"elm","emacs-lisp":"el",erb:"erb",erl:"erl",erlang:"erl",f:"f","f#":"fs",f03:"f03",f08:"f08",f18:"f18",f77:"f77",f90:"f90",f95:"f95",fennel:"fnl",fish:"fish",fluent:"ftl",for:"for","fortran-fixed-form":"f","fortran-free-form":"f90",fs:"fs",fsharp:"fs",fsl:"fsl",ftl:"ftl",gdresource:"tres",gdscript:"gd",gdshader:"gdshader",genie:"gs",gherkin:"feature","git-commit":"gitcommit","git-rebase":"gitrebase",gjs:"js",gleam:"gleam","glimmer-js":"js","glimmer-ts":"ts",glsl:"glsl",gnuplot:"plt",go:"go",gql:"gql",graphql:"graphql",groovy:"groovy",gts:"gts",hack:"hack",haml:"haml",handlebars:"hbs",haskell:"hs",haxe:"hx",hbs:"hbs",hcl:"hcl",hjson:"hjson",hlsl:"hlsl",hs:"hs",html:"html","html-derivative":"html",http:"http",hxml:"hxml",hy:"hy",imba:"imba",ini:"ini",jade:"jade",java:"java",javascript:"js",jinja:"jinja",jison:"jison",jl:"jl",js:"js",json:"json",json5:"json5",jsonc:"jsonc",jsonl:"jsonl",jsonnet:"jsonnet",jssm:"jssm",jsx:"jsx",julia:"jl",kotlin:"kt",kql:"kql",kt:"kt",kts:"kts",kusto:"kql",latex:"tex",lean:"lean",lean4:"lean",less:"less",liquid:"liquid",lisp:"lisp",lit:"lit",llvm:"ll",log:"log",logo:"logo",lua:"lua",luau:"luau",make:"mak",makefile:"mak",markdown:"md",marko:"marko",matlab:"m",md:"md",mdc:"mdc",mdx:"mdx",mediawiki:"wiki",mermaid:"mmd",mips:"s",mipsasm:"s",mmd:"mmd",mojo:"mojo",move:"move",nar:"nar",narrat:"narrat",nextflow:"nf",nf:"nf",nginx:"conf",nim:"nim",nix:"nix",nu:"nu",nushell:"nu",objc:"m","objective-c":"m","objective-cpp":"mm",ocaml:"ml",pascal:"pas",perl:"pl",perl6:"p6",php:"php",plsql:"pls",po:"po",polar:"polar",postcss:"pcss",pot:"pot",potx:"potx",powerquery:"pq",powershell:"ps1",prisma:"prisma",prolog:"pl",properties:"properties",proto:"proto",protobuf:"proto",ps:"ps",ps1:"ps1",pug:"pug",puppet:"pp",purescript:"purs",py:"py",python:"py",ql:"ql",qml:"qml",qmldir:"qmldir",qss:"qss",r:"r",racket:"rkt",raku:"raku",razor:"cshtml",rb:"rb",reg:"reg",regex:"regex",regexp:"regexp",rel:"rel",riscv:"s",rs:"rs",rst:"rst",ruby:"rb",rust:"rs",sas:"sas",sass:"sass",scala:"scala",scheme:"scm",scss:"scss",sdbl:"sdbl",sh:"sh",shader:"shader",shaderlab:"shader",shell:"sh",shellscript:"sh",shellsession:"sh",smalltalk:"st",solidity:"sol",soy:"soy",sparql:"rq",spl:"spl",splunk:"spl",sql:"sql","ssh-config":"config",stata:"do",styl:"styl",stylus:"styl",svelte:"svelte",swift:"swift","system-verilog":"sv",systemd:"service",talon:"talon",talonscript:"talon",tasl:"tasl",tcl:"tcl",templ:"templ",terraform:"tf",tex:"tex",tf:"tf",tfvars:"tfvars",toml:"toml",ts:"ts","ts-tags":"ts",tsp:"tsp",tsv:"tsv",tsx:"tsx",turtle:"ttl",twig:"twig",typ:"typ",typescript:"ts",typespec:"tsp",typst:"typ",v:"v",vala:"vala",vb:"vb",verilog:"v",vhdl:"vhdl",vim:"vim",viml:"vim",vimscript:"vim",vue:"vue","vue-html":"html","vue-vine":"vine",vy:"vy",vyper:"vy",wasm:"wasm",wenyan:"wy",wgsl:"wgsl",wiki:"wiki",wikitext:"wiki",wit:"wit",wl:"wl",wolfram:"wl",xml:"xml",xsl:"xsl",yaml:"yaml",yml:"yml",zenscript:"zs",zig:"zig",zsh:"zsh",\u6587\u8A00:"wy"},rt=({onDownload:e,onError:t,language:n,children:o,className:a,code:r,...i})=>{let{code:l}=le(Ae),{isAnimating:s}=le(F),c=r!=null?r:l,m=`file.${n&&n in et?et[n]:"txt"}`,f="text/plain",h=()=>{try{Y(m,c,f),e==null||e()}catch(w){t==null||t(w)}};return G("button",{className:y("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),disabled:s,onClick:h,title:"Download file",type:"button",...i,children:o!=null?o:G(pn,{size:14})})},at=({onCopy:e,onError:t,timeout:n=2e3,children:o,className:a,code:r,...i})=>{let[l,s]=Be(!1),c=nt(0),{code:d}=le(Ae),{isAnimating:m}=le(F),f=r!=null?r:d,h=async()=>{var T;if(typeof window=="undefined"||!((T=navigator==null?void 0:navigator.clipboard)!=null&&T.writeText)){t==null||t(new Error("Clipboard API not available"));return}try{l||(await navigator.clipboard.writeText(f),s(!0),e==null||e(),c.current=window.setTimeout(()=>s(!1),n))}catch(L){t==null||t(L)}};tt(()=>()=>{window.clearTimeout(c.current)},[]);let w=l?un:mn;return G("button",{className:y("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",a),disabled:m,onClick:h,type:"button",...i,children:o!=null?o:G(w,{size:14})})};import{DownloadIcon as yn}from"lucide-react";import{jsx as fe,jsxs as vn}from"react/jsx-runtime";var st=({node:e,className:t,src:n,alt:o,...a})=>{let r=async()=>{var i;if(n)try{let s=await(await fetch(n)).blob(),d=new URL(n,window.location.origin).pathname.split("/").pop()||"",m=d.includes(".")&&((i=d.split(".").pop())==null?void 0:i.length)<=4,f="";if(m)f=d;else{let h=s.type,w="png";h.includes("jpeg")||h.includes("jpg")?w="jpg":h.includes("png")?w="png":h.includes("svg")?w="svg":h.includes("gif")?w="gif":h.includes("webp")&&(w="webp"),f=`${(o||d||"image").replace(/\.[^/.]+$/,"")}.${w}`}Y(f,s,s.type)}catch(l){console.error("Failed to download image:",l)}};return n?vn("div",{className:"group relative my-4 inline-block","data-streamdown":"image-wrapper",children:[fe("img",{alt:o,className:y("max-w-full rounded-lg",t),"data-streamdown":"image",src:n,...a}),fe("div",{className:"pointer-events-none absolute inset-0 hidden rounded-lg bg-black/10 group-hover:block"}),fe("button",{className:y("absolute right-2 bottom-2 flex h-8 w-8 cursor-pointer items-center justify-center rounded-md border border-border bg-background/90 shadow-sm backdrop-blur-sm transition-all duration-200 hover:bg-background","opacity-0 group-hover:opacity-100"),onClick:r,title:"Download image",type:"button",children:fe(yn,{size:14})})]}):null};var $=function(){return $=Object.assign||function(t){for(var n,o=1,a=arguments.length;o<a;o++){n=arguments[o];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},$.apply(this,arguments)};typeof window!="undefined"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(t,n){n=n||{bubbles:!1,cancelable:!1,detail:null};var o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n.bubbles,n.cancelable,n.detail),o}));var kn=typeof document!="undefined"&&!!document.documentMode,He;function Mn(){return He||(He=document.createElement("div").style)}var it=["webkit","moz","ms"],he={};function je(e){if(he[e])return he[e];var t=Mn();if(e in t)return he[e]=e;for(var n=e[0].toUpperCase()+e.slice(1),o=it.length;o--;){var a="".concat(it[o]).concat(n);if(a in t)return he[e]=a}}function ge(e,t){return parseFloat(t[je(e)])||0}function be(e,t,n){n===void 0&&(n=window.getComputedStyle(e));var o=t==="border"?"Width":"";return{left:ge("".concat(t,"Left").concat(o),n),right:ge("".concat(t,"Right").concat(o),n),top:ge("".concat(t,"Top").concat(o),n),bottom:ge("".concat(t,"Bottom").concat(o),n)}}function ne(e,t,n){e.style[je(t)]=n}function xn(e,t){var n=je("transform");ne(e,"transition","".concat(n," ").concat(t.duration,"ms ").concat(t.easing))}function Cn(e,t,n){var o=t.x,a=t.y,r=t.scale,i=t.isSVG;if(ne(e,"transform","scale(".concat(r,") translate(").concat(o,"px, ").concat(a,"px)")),i&&kn){var l=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",l)}}function Re(e){var t=e.parentNode,n=window.getComputedStyle(e),o=window.getComputedStyle(t),a=e.getBoundingClientRect(),r=t.getBoundingClientRect();return{elem:{style:n,width:a.width,height:a.height,top:a.top,bottom:a.bottom,left:a.left,right:a.right,margin:be(e,"margin",n),border:be(e,"border",n)},parent:{style:o,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,padding:be(t,"padding",o),border:be(t,"border",o)}}}var ce={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window!="undefined"&&(typeof window.PointerEvent=="function"?ce={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(ce={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function Ee(e,t,n,o){ce[e].split(" ").forEach(function(a){t.addEventListener(a,n,o)})}function ze(e,t,n){ce[e].split(" ").forEach(function(o){t.removeEventListener(o,n)})}function ct(e,t){for(var n=e.length;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Oe(e,t){var n;if(t.touches){n=0;for(var o=0,a=t.touches;o<a.length;o++){var r=a[o];r.pointerId=n++,Oe(e,r)}return}n=ct(e,t),n>-1&&e.splice(n,1),e.push(t)}function Nn(e,t){if(t.touches){for(;e.length;)e.pop();return}var n=ct(e,t);n>-1&&e.splice(n,1)}function lt(e){e=e.slice(0);for(var t=e.pop(),n;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function De(e){if(e.length<2)return 0;var t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}function Pn(e){for(var t=e;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function Tn(e){return(e.getAttribute("class")||"").trim()}function Sn(e,t){return e.nodeType===1&&" ".concat(Tn(e)," ").indexOf(" ".concat(t," "))>-1}function In(e,t){for(var n=e;n!=null;n=n.parentNode)if(Sn(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}var Bn=/^http:[\w\.\/]+svg$/;function Ln(e){return Bn.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function An(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var dt={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:function(e){e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:Cn,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function qe(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!Pn(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t=$($({},dt),t);var n=Ln(e),o=e.parentNode;o.style.overflow=t.overflow,o.style.userSelect="none",o.style.touchAction=t.touchAction,(t.canvas?o:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,ne(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function a(){o.style.overflow="",o.style.userSelect="",o.style.touchAction="",o.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",ne(e,"transformOrigin","")}function r(u){u===void 0&&(u={});for(var b in u)u.hasOwnProperty(b)&&(t[b]=u[b]);(u.hasOwnProperty("cursor")||u.hasOwnProperty("canvas"))&&(o.style.cursor=e.style.cursor="",(t.canvas?o:e).style.cursor=t.cursor),u.hasOwnProperty("overflow")&&(o.style.overflow=u.overflow),u.hasOwnProperty("touchAction")&&(o.style.touchAction=u.touchAction,e.style.touchAction=u.touchAction)}var i=0,l=0,s=1,c=!1;T(t.startScale,{animate:!1,force:!0}),setTimeout(function(){w(t.startX,t.startY,{animate:!1,force:!0})});function d(u,b,k){if(!k.silent){var P=new CustomEvent(u,{detail:b});e.dispatchEvent(P)}}function m(u,b,k){var P={x:i,y:l,scale:s,isSVG:n,originalEvent:k};return requestAnimationFrame(function(){typeof b.animate=="boolean"&&(b.animate?xn(e,b):ne(e,"transition","none")),b.setTransform(e,P,b),d(u,P,b),d("panzoomchange",P,b)}),P}function f(u,b,k,P){var p=$($({},t),P),x={x:i,y:l,opts:p};if(!p.force&&(p.disablePan||p.panOnlyWhenZoomed&&s===p.startScale))return x;if(u=parseFloat(u),b=parseFloat(b),p.disableXAxis||(x.x=(p.relative?i:0)+u),p.disableYAxis||(x.y=(p.relative?l:0)+b),p.contain){var v=Re(e),O=v.elem.width/s,U=v.elem.height/s,se=O*k,ie=U*k,Z=(se-O)/2,K=(ie-U)/2;if(p.contain==="inside"){var Ce=(-v.elem.margin.left-v.parent.padding.left+Z)/k,Ne=(v.parent.width-se-v.parent.padding.left-v.elem.margin.left-v.parent.border.left-v.parent.border.right+Z)/k;x.x=Math.max(Math.min(x.x,Ne),Ce);var Pe=(-v.elem.margin.top-v.parent.padding.top+K)/k,Te=(v.parent.height-ie-v.parent.padding.top-v.elem.margin.top-v.parent.border.top-v.parent.border.bottom+K)/k;x.y=Math.max(Math.min(x.y,Te),Pe)}else if(p.contain==="outside"){var Ce=(-(se-v.parent.width)-v.parent.padding.left-v.parent.border.left-v.parent.border.right+Z)/k,Ne=(Z-v.parent.padding.left)/k;x.x=Math.max(Math.min(x.x,Ne),Ce);var Pe=(-(ie-v.parent.height)-v.parent.padding.top-v.parent.border.top-v.parent.border.bottom+K)/k,Te=(K-v.parent.padding.top)/k;x.y=Math.max(Math.min(x.y,Te),Pe)}}return p.roundPixels&&(x.x=Math.round(x.x),x.y=Math.round(x.y)),x}function h(u,b){var k=$($({},t),b),P={scale:s,opts:k};if(!k.force&&k.disableZoom)return P;var p=t.minScale,x=t.maxScale;if(k.contain){var v=Re(e),O=v.elem.width/s,U=v.elem.height/s;if(O>1&&U>1){var se=v.parent.width-v.parent.border.left-v.parent.border.right,ie=v.parent.height-v.parent.border.top-v.parent.border.bottom,Z=se/O,K=ie/U;t.contain==="inside"?x=Math.min(x,Z,K):t.contain==="outside"&&(p=Math.max(p,Z,K))}}return P.scale=Math.min(Math.max(u,p),x),P}function w(u,b,k,P){var p=f(u,b,s,k);return i!==p.x||l!==p.y?(i=p.x,l=p.y,m("panzoompan",p.opts,P)):{x:i,y:l,scale:s,isSVG:n,originalEvent:P}}function T(u,b,k){var P=h(u,b),p=P.opts;if(!(!p.force&&p.disableZoom)){u=P.scale;var x=i,v=l;if(p.focal){var O=p.focal;x=(O.x/u-O.x/s+i*u)/u,v=(O.y/u-O.y/s+l*u)/u}var U=f(x,v,u,{relative:!1,force:!0});return i=U.x,l=U.y,s=u,m("panzoomzoom",p,k)}}function L(u,b){var k=$($($({},t),{animate:!0}),b);return T(s*Math.exp((u?1:-1)*k.step),k)}function C(u){return L(!0,u)}function H(u){return L(!1,u)}function S(u,b,k,P){var p=Re(e),x={width:p.parent.width-p.parent.padding.left-p.parent.padding.right-p.parent.border.left-p.parent.border.right,height:p.parent.height-p.parent.padding.top-p.parent.padding.bottom-p.parent.border.top-p.parent.border.bottom},v=b.clientX-p.parent.left-p.parent.padding.left-p.parent.border.left-p.elem.margin.left,O=b.clientY-p.parent.top-p.parent.padding.top-p.parent.border.top-p.elem.margin.top;n||(v-=p.elem.width/s/2,O-=p.elem.height/s/2);var U={x:v/x.width*(x.width*u),y:O/x.height*(x.height*u)};return T(u,$($({},k),{animate:!1,focal:U}),P)}function R(u,b){u.preventDefault();var k=$($($({},t),b),{animate:!1}),P=u.deltaY===0&&u.deltaX?u.deltaX:u.deltaY,p=P<0?1:-1,x=h(s*Math.exp(p*k.step/3),k).scale;return S(x,u,k,u)}function ee(u){var b=$($($({},t),{animate:!0,force:!0}),u);s=h(b.startScale,b).scale;var k=f(b.startX,b.startY,s,b);return i=k.x,l=k.y,m("panzoomreset",b)}var ae,te,g,D,E,q,B=[];function W(u){if(!In(u.target,t)){Oe(B,u),c=!0,t.handleStartEvent(u),ae=i,te=l,d("panzoomstart",{x:i,y:l,scale:s,isSVG:n,originalEvent:u},t);var b=lt(B);g=b.clientX,D=b.clientY,E=s,q=De(B)}}function V(u){if(!(!c||ae===void 0||te===void 0||g===void 0||D===void 0)){Oe(B,u);var b=lt(B),k=B.length>1,P=s;if(k){q===0&&(q=De(B));var p=De(B)-q;P=h(p*t.step/80+E).scale,S(P,b,{animate:!1},u)}(!k||t.pinchAndPan)&&w(ae+(b.clientX-g)/P,te+(b.clientY-D)/P,{animate:!1},u)}}function J(u){B.length===1&&d("panzoomend",{x:i,y:l,scale:s,isSVG:n,originalEvent:u},t),Nn(B,u),c&&(c=!1,ae=te=g=D=void 0)}var _=!1;function X(){_||(_=!0,Ee("down",t.canvas?o:e,W),Ee("move",document,V,{passive:!0}),Ee("up",document,J,{passive:!0}))}function z(){_=!1,ze("down",t.canvas?o:e,W),ze("move",document,V),ze("up",document,J)}return t.noBind||X(),{bind:X,destroy:z,eventNames:ce,getPan:function(){return{x:i,y:l}},getScale:function(){return s},getOptions:function(){return An(t)},handleDown:W,handleMove:V,handleUp:J,pan:w,reset:ee,resetStyle:a,setOptions:r,setStyle:function(u,b){return ne(e,u,b)},zoom:T,zoomIn:C,zoomOut:H,zoomToPoint:S,zoomWithWheel:R}}qe.defaultOptions=dt;import{forwardRef as $n,useEffect as ut,useImperativeHandle as Hn,useMemo as Rn,useRef as de,useState as We}from"react";import{jsx as _e,jsxs as Xe}from"react/jsx-runtime";var En=async e=>{let n={...{startOnLoad:!1,theme:"default",securityLevel:"strict",fontFamily:"monospace",suppressErrorRendering:!0},...e},a=(await import("mermaid")).default;return a.initialize(n),a},mt=0,pt="28rem",zn=()=>(mt+=1,`streamdown-mermaid-${Date.now().toString(36)}-${mt.toString(36)}`),ue=$n(({chart:e,className:t,config:n,onPanzoomReady:o,enablePanZoom:a=!1,renderId:r},i)=>{let l=de(null),s=de(null),c=de(null),d=de(void 0),m=de(""),[f,h]=We(null),[w,T]=We(!0),[L,C]=We(!1);ut(()=>{d.current=o},[o]),Hn(i,()=>({reset:()=>{var g;(g=s.current)==null||g.reset()},zoomIn:()=>{var g;(g=s.current)==null||g.zoomIn()},zoomOut:()=>{var g;(g=s.current)==null||g.zoomOut()}}),[]);let H=()=>{var g;c.current&&l.current&&l.current.removeEventListener("wheel",c.current),c.current=null,s.current&&(s.current.destroy(),s.current=null),(g=d.current)==null||g.call(d,!1)},S=g=>{g.removeAttribute("width"),g.removeAttribute("height"),g.setAttribute("preserveAspectRatio","xMidYMid meet"),g.style.display="block",g.style.margin="0 auto",a?(g.style.width="auto",g.style.height="100%",g.style.maxWidth="100%",g.style.maxHeight="100%"):(g.style.width="100%",g.style.height="auto",g.style.maxWidth="100%",g.style.maxHeight=pt)},R=g=>{var B;let D=(B=g.viewBox)==null?void 0:B.baseVal;if(D&&D.width>0&&D.height>0)return{width:D.width,height:D.height};let E=g.getBBox();if(E.width>0&&E.height>0)return{width:E.width,height:E.height};let q=g.getBoundingClientRect();return{width:q.width||1,height:q.height||1}},ee=g=>{var q;H(),S(g);let D=qe(g,{animate:!0,contain:a?null:"inside",duration:200,easing:"ease-in-out",maxScale:a?10:5,minScale:.5,step:.1,startScale:1});if(s.current=D,l.current){let B=W=>{s.current&&(W.preventDefault(),s.current.zoomWithWheel(W))};l.current.addEventListener("wheel",B,{passive:!1}),c.current=B}g.style.cursor="grab";let E=l.current;E&&requestAnimationFrame(()=>{if(!s.current)return;let{width:B,height:W}=R(g);if(B===0||W===0)return;let V=E.getBoundingClientRect(),J=V.width/B,_=V.height/W,X=Math.min(J,_,1),z=Number.isFinite(X)&&X>0?X:1,u=a?z*1:z;s.current.setOptions({minScale:z*.5,maxScale:z*8}),s.current.reset({animate:!1}),s.current.zoom(z,{animate:!1})}),(q=d.current)==null||q.call(d,!0)};if(ut(()=>{let g=!1;return(async()=>{var W,V,J;let E=l.current;if(!E)return;T(!0),h(null),(W=d.current)==null||W.call(d,!1);let q=E.innerHTML,B=r!=null?r:zn();try{let _=await En(n);if(g)return;H();let{svg:X}=await _.render(B,e);if(g||!l.current)return;l.current.innerHTML=X;let z=l.current.querySelector("svg");if(z instanceof SVGElement&&(z.id=B,a?ee(z):(S(z),(V=d.current)==null||V.call(d,!0))),g)return;m.current=E.innerHTML,C(!0)}catch(_){if(g)return;let X=m.current;if(X&&l.current){l.current.innerHTML=X;let u=l.current.querySelector("svg");u instanceof SVGElement&&(u.id=B,a?ee(u):(S(u),(J=d.current)==null||J.call(d,!0))),C(!0)}else E.innerHTML=q,C(!1);let z=_ instanceof Error?_.message:"Failed to render Mermaid chart";X||h(z)}finally{g||T(!1)}})(),()=>{g=!0,H()}},[e,n]),!(L||!!m.current)&&f)return Xe("div",{className:y("my-4 rounded-lg border border-red-200 bg-red-50 p-4",t),children:[Xe("p",{className:"font-mono text-red-700 text-sm",children:["Mermaid Error: ",f]}),Xe("details",{className:"mt-2",children:[_e("summary",{className:"cursor-pointer text-red-600 text-xs",children:"Show Code"}),_e("pre",{className:"mt-2 overflow-x-auto rounded bg-red-100 p-2 text-red-800 text-xs",children:e})]})]});let te=Rn(()=>a?{height:"100%",maxHeight:"100%"}:{maxHeight:pt},[a]);return _e("div",{"aria-label":"Mermaid chart",className:y("flex w-full items-center justify-center",a?"my-0 h-full overflow-hidden":"my-4 max-h-[28rem] overflow-auto",t),ref:l,style:te,role:"img"})});ue.displayName="Mermaid";import{CopyIcon as Ue,DownloadIcon as Ge,Maximize as Dn,RefreshCw as On,X as jn,ZoomIn as qn,ZoomOut as Wn}from"lucide-react";import{useCallback as me,useContext as ht,useEffect as we,useRef as ye,useState as Fe}from"react";import{Fragment as Ve,jsx as N,jsxs as j}from"react/jsx-runtime";var ft=(e,t)=>{if(typeof document!="undefined"&&t){let o=document.getElementById(t);if(o instanceof SVGElement)return o}let n=e==null?void 0:e.closest('[data-streamdown="mermaid-block"]');return n==null?void 0:n.querySelector("svg")},gt=({className:e,chart:t,onCopy:n,onDownload:o,onError:a,timeout:r=2e3,type:i,renderId:l})=>{let{isAnimating:s}=ht(F),c=ye(null),[d,m]=Fe(!1),f=ye(0);we(()=>{let S=R=>{c.current&&!c.current.contains(R.target)&&m(!1)};return document.addEventListener("mousedown",S),()=>{document.removeEventListener("mousedown",S)}},[]),we(()=>()=>{window.clearTimeout(f.current)},[]);let h=async()=>{var S;if(typeof window=="undefined"||!((S=navigator==null?void 0:navigator.clipboard)!=null&&S.write)){a==null||a(new Error("Clipboard API not available"));return}try{let R=ft(c.current,l);if(!R)throw new Error("Mermaid diagram not found");let ee=await Se(R,1);await navigator.clipboard.write([new ClipboardItem({"image/png":ee})]),n==null||n(),m(!1)}catch(R){a==null||a(R)}},w=async()=>{var S;if(typeof window=="undefined"||!((S=navigator==null?void 0:navigator.clipboard)!=null&&S.writeText)){a==null||a(new Error("Clipboard API not available"));return}try{await navigator.clipboard.writeText(t),n==null||n(),m(!1)}catch(R){a==null||a(R)}},T=async()=>{try{let S=ft(c.current,l);if(console.log("svgElement",S),!S)throw new Error("Mermaid diagram not found");let R=await Se(S,1);console.log("blob",R),Y(`mermaid-diagram-${Date.now()}.png`,R,"image/png"),o==null||o(),m(!1)}catch(S){a==null||a(S)}},L=()=>{try{Y(`mermaid-diagram-${Date.now()}.mmd`,t,"text/plain"),o==null||o(),m(!1)}catch(S){a==null||a(S)}},C=i==="download"?Ge:Ue,H=i==="download"?"Download diagram":"Copy diagram";return j("div",{className:"relative",ref:c,children:[N("button",{className:y("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50 w-fit",e),disabled:s,onClick:()=>m(S=>!S),title:H,type:"button",children:N(C,{size:14})}),d&&N("div",{className:"absolute top-full right-0 z-10 mt-1 w-max rounded-md border border-border bg-background shadow-lg",style:{width:"max-content"},children:i==="copy"?j(Ve,{children:[j("button",{className:"flex w-max items-center gap-2 px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:h,type:"button",style:{width:"max-content"},children:[N(Ue,{className:"h-4 w-4"}),N("span",{children:"Copy as PNG"})]}),j("button",{className:"flex w-max items-center gap-2 px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:w,type:"button",style:{width:"max-content"},children:[N(Ue,{className:"h-4 w-4"}),N("span",{children:"Copy as MMD"})]})]}):j(Ve,{children:[j("button",{className:"flex w-max items-center gap-2 px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:T,type:"button",style:{width:"max-content"},children:[N(Ge,{className:"h-4 w-4"}),N("span",{children:"Download as PNG"})]}),j("button",{className:"flex w-max items-center gap-2 px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:L,type:"button",style:{width:"max-content"},children:[N(Ge,{className:"h-4 w-4"}),N("span",{children:"Download as MMD"})]})]})})]})},bt=({className:e,chart:t,onCopy:n,onError:o,timeout:a=2e3,renderId:r})=>N(gt,{chart:t,className:e,onCopy:n,onError:o,timeout:a,renderId:r,type:"copy"}),wt=({className:e,chart:t,onDownload:n,onError:o,renderId:a})=>N(gt,{chart:t,className:e,onDownload:n,onError:o,renderId:a,type:"download"}),yt=({chart:e,config:t,children:n,className:o,...a})=>{let[r,i]=Fe(!1),{isAnimating:l}=ht(F),s=ye(null),c=ye(null),[d,m]=Fe(!1),f=me(()=>{i(C=>!C)},[]),h=me(C=>{c.current=C},[]),w=me(()=>{var C;(C=c.current)==null||C.zoomIn()},[]),T=me(()=>{var C;(C=c.current)==null||C.zoomOut()},[]),L=me(()=>{var C;(C=c.current)==null||C.reset()},[]);return we(()=>{let C=H=>{H.key==="Escape"&&r&&i(!1)};if(r){document.addEventListener("keydown",C),document.body.style.overflow="hidden";let H=document.createElement("style");H.id="streamdown-fullscreen-scrollbar-hide",H.textContent=`
        .streamdown-fullscreen-scroll::-webkit-scrollbar {
          display: none;
        }
      `,document.head.appendChild(H)}return()=>{document.removeEventListener("keydown",C),document.body.style.overflow="";let H=document.getElementById("streamdown-fullscreen-scrollbar-hide");H&&H.remove()}},[r]),we(()=>{r||(c.current=null,m(!1))},[r]),j(Ve,{children:[N("button",{className:y("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",o),disabled:l,onClick:f,title:"View fullscreen",type:"button",...a,children:n!=null?n:N(Dn,{size:14})}),r&&N("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/95 backdrop-blur-sm p-4 sm:p-6 md:p-8",onClick:f,children:j("div",{className:"relative flex h-full w-full max-h-[calc(100vh-2rem)] max-w-[calc(100vw-2rem)] flex-col overflow-hidden rounded-xl border bg-background shadow-2xl sm:max-h-[calc(100vh-3rem)] sm:max-w-[calc(100vw-3rem)] md:max-h-[calc(100vh-4rem)] md:max-w-[calc(100vw-4rem)]",onClick:C=>C.stopPropagation(),children:[N("button",{className:"absolute top-4 right-4 z-10 cursor-pointer rounded-md p-2 text-muted-foreground transition-all hover:bg-muted hover:text-foreground",onClick:f,title:"Close fullscreen (ESC)",type:"button",children:N(jn,{size:20})}),r&&N("div",{className:"absolute left-1/2 top-4 z-10 -translate-x-1/2 transform rounded-md border bg-background/95 shadow-lg",children:j("div",{className:"flex items-center divide-x divide-border/70",children:[j("button",{className:"flex items-center gap-2 px-3 py-2 text-muted-foreground transition hover:bg-muted hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-60",disabled:!d,onClick:T,title:"Zoom out",type:"button",children:[N(Wn,{className:"h-4 w-4"}),N("span",{className:"hidden sm:inline",children:"Out"})]}),j("button",{className:"flex items-center gap-2 px-3 py-2 text-muted-foreground transition hover:bg-muted hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-60",disabled:!d,onClick:L,title:"Reset view",type:"button",children:[N(On,{className:"h-4 w-4"}),N("span",{className:"hidden sm:inline",children:"Reset"})]}),j("button",{className:"flex items-center gap-2 px-3 py-2 text-muted-foreground transition hover:bg-muted hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-60",disabled:!d,onClick:w,title:"Zoom in",type:"button",children:[N(qn,{className:"h-4 w-4"}),N("span",{className:"hidden sm:inline",children:"In"})]})]})}),N("div",{ref:s,className:"streamdown-fullscreen-scroll flex h-full items-center justify-center overflow-hidden p-4 sm:p-6 md:p-8",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:N("div",{className:"h-full w-full",children:N(ue,{chart:e,className:"my-0 h-full",config:t,enablePanZoom:!0,onPanzoomReady:m,ref:h})})})]})})]})};import{CheckIcon as Xn,CopyIcon as _n,DownloadIcon as Un}from"lucide-react";import{useContext as kt,useEffect as Mt,useRef as xt,useState as Ct}from"react";import{jsx as oe,jsxs as vt}from"react/jsx-runtime";function Nt(e){var r,i;let t=[],n=[],o=e.querySelectorAll("thead th");for(let l of o)t.push(((r=l.textContent)==null?void 0:r.trim())||"");let a=e.querySelectorAll("tbody tr");for(let l of a){let s=[],c=l.querySelectorAll("td");for(let d of c)s.push(((i=d.textContent)==null?void 0:i.trim())||"");n.push(s)}return{headers:t,rows:n}}function Pt(e){let{headers:t,rows:n}=e,o=r=>r.includes(",")||r.includes('"')||r.includes(`
`)?`"${r.replace(/"/g,'""')}"`:r,a=[];t.length>0&&a.push(t.map(o).join(","));for(let r of n)a.push(r.map(o).join(","));return a.join(`
`)}function Tt(e){let{headers:t,rows:n}=e;if(t.length===0)return"";let o=[],a=t.map(r=>r.replace(/\|/g,"\\|"));o.push(`| ${a.join(" | ")} |`),o.push(`| ${t.map(()=>"---").join(" | ")} |`);for(let r of n){let i=[...r];for(;i.length<t.length;)i.push("");let l=i.map(s=>s.replace(/\|/g,"\\|"));o.push(`| ${l.join(" | ")} |`)}return o.join(`
`)}var St=({children:e,className:t,onCopy:n,onError:o,timeout:a=2e3,format:r="markdown"})=>{let[i,l]=Ct(!1),s=xt(0),{isAnimating:c}=kt(F),d=async f=>{var h;if(typeof window=="undefined"||!((h=navigator==null?void 0:navigator.clipboard)!=null&&h.write)){o==null||o(new Error("Clipboard API not available"));return}try{if(!i){let T=f.currentTarget.closest('[data-streamdown="table-wrapper"]'),L=T==null?void 0:T.querySelector("table");if(!L){o==null||o(new Error("Table not found"));return}let C=Nt(L),H=new ClipboardItem({"text/plain":r==="markdown"?Tt(C):Pt(C),"text/html":new Blob([L.outerHTML],{type:"text/html"})});await navigator.clipboard.write([H]),l(!0),n==null||n(),s.current=window.setTimeout(()=>l(!1),a)}}catch(w){o==null||o(w)}};Mt(()=>()=>{window.clearTimeout(s.current)},[]);let m=i?Xn:_n;return oe("button",{className:y("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:c,onClick:d,title:`Copy table as ${r}`,type:"button",children:e!=null?e:oe(m,{size:14})})};var It=({children:e,className:t,onDownload:n,onError:o})=>{let[a,r]=Ct(!1),i=xt(null),{isAnimating:l}=kt(F),s=c=>{var d;try{let m=(d=i.current)==null?void 0:d.closest('[data-streamdown="table-wrapper"]'),f=m==null?void 0:m.querySelector("table");if(!f){o==null||o(new Error("Table not found"));return}let h=Nt(f),w=c==="csv"?Pt(h):Tt(h);Y(`table.${c==="csv"?"csv":"md"}`,w,c==="csv"?"text/csv":"text/markdown"),r(!1),n==null||n(c)}catch(m){o==null||o(m)}};return Mt(()=>{let c=d=>{i.current&&!i.current.contains(d.target)&&r(!1)};return document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[]),vt("div",{className:"relative",ref:i,children:[oe("button",{className:y("cursor-pointer p-1 text-muted-foreground transition-all hover:text-foreground disabled:cursor-not-allowed disabled:opacity-50",t),disabled:l,onClick:()=>r(!a),title:"Download table",type:"button",children:e!=null?e:oe(Un,{size:14})}),a&&vt("div",{className:"absolute top-full right-0 z-10 mt-1 min-w-[120px] rounded-md border border-border bg-background shadow-lg",children:[oe("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>s("csv"),type:"button",children:"CSV"}),oe("button",{className:"w-full px-3 py-2 text-left text-sm transition-colors hover:bg-muted/40",onClick:()=>s("markdown"),type:"button",children:"Markdown"})]})]})};import{Fragment as tn,jsx as M,jsxs as pe}from"react/jsx-runtime";var Fn=/language-([^\s]+)/;function ve(e,t){if(!(e!=null&&e.position||t!=null&&t.position))return!0;if(!(e!=null&&e.position&&(t!=null&&t.position)))return!1;let n=e.position.start,o=t.position.start,a=e.position.end,r=t.position.end;return(n==null?void 0:n.line)===(o==null?void 0:o.line)&&(n==null?void 0:n.column)===(o==null?void 0:o.column)&&(a==null?void 0:a.line)===(r==null?void 0:r.line)&&(a==null?void 0:a.column)===(r==null?void 0:r.column)}function A(e,t){return e.className===t.className&&ve(e.node,t.node)}var Je=(e,t)=>typeof e=="boolean"?e:e[t]!==!1,Ze=I(({children:e,className:t,node:n,...o})=>M("ol",{className:y("ml-4 list-outside list-decimal whitespace-normal",t),"data-streamdown":"ordered-list",...o,children:e}),(e,t)=>A(e,t));Ze.displayName="MarkdownOl";var Bt=I(({children:e,className:t,node:n,...o})=>M("li",{className:y("py-1",t),"data-streamdown":"list-item",...o,children:e}),(e,t)=>e.className===t.className&&ve(e.node,t.node));Bt.displayName="MarkdownLi";var Lt=I(({children:e,className:t,node:n,...o})=>M("ul",{className:y("ml-4 list-outside list-disc whitespace-normal",t),"data-streamdown":"unordered-list",...o,children:e}),(e,t)=>A(e,t));Lt.displayName="MarkdownUl";var At=I(({className:e,node:t,...n})=>M("hr",{className:y("my-6 border-border",e),"data-streamdown":"horizontal-rule",...n}),(e,t)=>A(e,t));At.displayName="MarkdownHr";var $t=I(({children:e,className:t,node:n,...o})=>M("span",{className:y("font-semibold",t),"data-streamdown":"strong",...o,children:e}),(e,t)=>A(e,t));$t.displayName="MarkdownStrong";var Ht=I(({children:e,className:t,href:n,node:o,...a})=>{let r=n==="streamdown:incomplete-link";return M("a",{className:y("wrap-anywhere font-medium text-primary underline",t),"data-incomplete":r,"data-streamdown":"link",href:n,rel:"noreferrer",target:"_blank",...a,children:e})},(e,t)=>A(e,t)&&e.href===t.href);Ht.displayName="MarkdownA";var Rt=I(({children:e,className:t,node:n,...o})=>M("h1",{className:y("mt-6 mb-2 font-semibold text-3xl",t),"data-streamdown":"heading-1",...o,children:e}),(e,t)=>A(e,t));Rt.displayName="MarkdownH1";var Et=I(({children:e,className:t,node:n,...o})=>M("h2",{className:y("mt-6 mb-2 font-semibold text-2xl",t),"data-streamdown":"heading-2",...o,children:e}),(e,t)=>A(e,t));Et.displayName="MarkdownH2";var zt=I(({children:e,className:t,node:n,...o})=>M("h3",{className:y("mt-6 mb-2 font-semibold text-xl",t),"data-streamdown":"heading-3",...o,children:e}),(e,t)=>A(e,t));zt.displayName="MarkdownH3";var Dt=I(({children:e,className:t,node:n,...o})=>M("h4",{className:y("mt-6 mb-2 font-semibold text-lg",t),"data-streamdown":"heading-4",...o,children:e}),(e,t)=>A(e,t));Dt.displayName="MarkdownH4";var Ot=I(({children:e,className:t,node:n,...o})=>M("h5",{className:y("mt-6 mb-2 font-semibold text-base",t),"data-streamdown":"heading-5",...o,children:e}),(e,t)=>A(e,t));Ot.displayName="MarkdownH5";var jt=I(({children:e,className:t,node:n,...o})=>M("h6",{className:y("mt-6 mb-2 font-semibold text-sm",t),"data-streamdown":"heading-6",...o,children:e}),(e,t)=>A(e,t));jt.displayName="MarkdownH6";var qt=I(({children:e,className:t,node:n,...o})=>{let a=Ye(ke),r=Je(a,"table");return pe("div",{className:"my-4 flex flex-col space-y-2","data-streamdown":"table-wrapper",children:[r&&pe("div",{className:"flex items-center justify-end gap-1",children:[M(St,{}),M(It,{})]}),M("div",{className:"overflow-x-auto",children:M("table",{className:y("w-full border-collapse border border-border",t),"data-streamdown":"table",...o,children:e})})]})},(e,t)=>A(e,t));qt.displayName="MarkdownTable";var Wt=I(({children:e,className:t,node:n,...o})=>M("thead",{className:y("bg-muted/80",t),"data-streamdown":"table-header",...o,children:e}),(e,t)=>A(e,t));Wt.displayName="MarkdownThead";var Xt=I(({children:e,className:t,node:n,...o})=>M("tbody",{className:y("divide-y divide-border bg-muted/40",t),"data-streamdown":"table-body",...o,children:e}),(e,t)=>A(e,t));Xt.displayName="MarkdownTbody";var _t=I(({children:e,className:t,node:n,...o})=>M("tr",{className:y("border-border border-b",t),"data-streamdown":"table-row",...o,children:e}),(e,t)=>A(e,t));_t.displayName="MarkdownTr";var Ut=I(({children:e,className:t,node:n,...o})=>M("th",{className:y("whitespace-nowrap px-4 py-2 text-left font-semibold text-sm",t),"data-streamdown":"table-header-cell",...o,children:e}),(e,t)=>A(e,t));Ut.displayName="MarkdownTh";var Gt=I(({children:e,className:t,node:n,...o})=>M("td",{className:y("px-4 py-2 text-sm",t),"data-streamdown":"table-cell",...o,children:e}),(e,t)=>A(e,t));Gt.displayName="MarkdownTd";var Ft=I(({children:e,className:t,node:n,...o})=>M("blockquote",{className:y("my-4 border-muted-foreground/30 border-l-4 pl-4 text-muted-foreground italic",t),"data-streamdown":"blockquote",...o,children:e}),(e,t)=>A(e,t));Ft.displayName="MarkdownBlockquote";var Vt=I(({children:e,className:t,node:n,...o})=>M("sup",{className:y("text-sm",t),"data-streamdown":"superscript",...o,children:e}),(e,t)=>A(e,t));Vt.displayName="MarkdownSup";var Yt=I(({children:e,className:t,node:n,...o})=>M("sub",{className:y("text-sm",t),"data-streamdown":"subscript",...o,children:e}),(e,t)=>A(e,t));Yt.displayName="MarkdownSub";var Jt=I(({children:e,className:t,node:n,...o})=>{if("data-footnotes"in o){let r=s=>{var f,h;if(!re(s))return!1;let c=Array.isArray(s.props.children)?s.props.children:[s.props.children],d=!1,m=!1;for(let w of c)if(w){if(typeof w=="string")w.trim()!==""&&(d=!0);else if(re(w))if(((f=w.props)==null?void 0:f["data-footnote-backref"])!==void 0)m=!0;else{let T=Array.isArray(w.props.children)?w.props.children:[w.props.children];for(let L of T){if(typeof L=="string"&&L.trim()!==""){d=!0;break}if(re(L)&&((h=L.props)==null?void 0:h["data-footnote-backref"])===void 0){d=!0;break}}}}return m&&!d},i=Array.isArray(e)?e.map(s=>{if(!re(s))return s;if(s.type===Ze){let d=(Array.isArray(s.props.children)?s.props.children:[s.props.children]).filter(m=>!r(m));return d.length===0?null:{...s,props:{...s.props,children:d}}}return s}):e;return(Array.isArray(i)?i.some(s=>s!==null):i!==null)?M("section",{className:t,...o,children:i}):null}return M("section",{className:t,...o,children:e})},(e,t)=>A(e,t));Jt.displayName="MarkdownSection";var Vn=({node:e,className:t,children:n,...o})=>{var m,f,h;let a=((m=e==null?void 0:e.position)==null?void 0:m.start.line)===((f=e==null?void 0:e.position)==null?void 0:f.end.line),r=Ye(Ke),i=Ye(ke);if(a)return M("code",{className:y("rounded bg-muted px-1.5 py-0.5 font-mono text-sm",t),"data-streamdown":"inline-code",...o,children:n});let l=t==null?void 0:t.match(Fn),s=(h=l==null?void 0:l.at(1))!=null?h:"code",c="";if(re(n)&&n.props&&typeof n.props=="object"&&"children"in n.props&&typeof n.props.children=="string"?c=n.props.children:typeof n=="string"&&(c=n),s==="mermaid"){let w=Je(i,"mermaid"),[T]=Gn(()=>`streamdown-mermaid-${Date.now().toString(36)}-${Math.random().toString(36).slice(2)}`),L=M(ue,{chart:c,config:r,renderId:T});return pe("div",{className:y("group relative my-4 h-auto rounded-xl border p-4",t),"data-streamdown":"mermaid-block",children:[w&&pe("div",{className:"flex items-center justify-end gap-2",children:[M(yt,{chart:c,config:r}),M(wt,{chart:c,renderId:T}),M(bt,{chart:c,renderId:T})]}),L]})}let d=Je(i,"code");return M(ot,{className:y("overflow-x-auto border-t",t),code:c,"data-language":s,"data-streamdown":"code-block",language:s,preClassName:"overflow-x-auto font-mono text-xs p-4 bg-muted/40",children:d&&pe(tn,{children:[M(rt,{code:c,language:s}),M(at,{})]})})},Zt=I(Vn,(e,t)=>e.className===t.className&&ve(e.node,t.node));Zt.displayName="MarkdownCode";var Kt=I(st,(e,t)=>e.className===t.className&&ve(e.node,t.node));Kt.displayName="MarkdownImg";var Qt=I(({children:e,className:t,node:n,...o})=>{var i;let r=(Array.isArray(e)?e:[e]).filter(l=>l!=null&&l!=="");return r.length===1&&re(r[0])&&((i=r[0].props.node)==null?void 0:i.tagName)==="img"?M(tn,{children:e}):M("p",{className:t,...o,children:e})},(e,t)=>A(e,t));Qt.displayName="MarkdownParagraph";var en={ol:Ze,li:Bt,ul:Lt,hr:At,strong:$t,a:Ht,h1:Rt,h2:Et,h3:zt,h4:Dt,h5:Ot,h6:jt,table:qt,thead:Wt,tbody:Xt,tr:_t,th:Ut,td:Gt,blockquote:Ft,code:Zt,img:Kt,pre:({children:e})=>e,sup:Vt,sub:Yt,p:Qt,section:Jt};import{Lexer as Yn}from"marked";var nn=e=>{let t=/\[\^[^\]\s]{1,200}\](?!:)/.test(e),n=/\[\^[^\]\s]{1,200}\]:/.test(e);if(t||n)return[e];let o=Yn.lex(e,{gfm:!0}),a=[],r=[];for(let i=0;i<o.length;i++){let l=o[i],s=l.raw;if(r.length>0){if(a[a.length-1]+=s,l.type==="html"){let c=s.match(/<\/(\w+)>/);if(c){let d=c[1];r[r.length-1]===d&&r.pop()}}continue}if(l.type==="html"&&l.block){let c=s.match(/<(\w+)[\s>]/);if(c){let d=c[1];s.includes(`</${d}>`)||r.push(d)}}if(s.trim()==="$$"&&a.length>0){let c=a.at(-1);if(!c){a.push(s);continue}let d=c.trimStart().startsWith("$$"),m=(c.match(/\$\$/g)||[]).length;if(d&&m%2===1){a[a.length-1]=c+s;continue}}if(a.length>0&&s.trimEnd().endsWith("$$")){let c=a.at(-1);if(!c){a.push(s);continue}let d=c.trimStart().startsWith("$$"),m=(c.match(/\$\$/g)||[]).length,f=(s.match(/\$\$/g)||[]).length;if(d&&m%2===1&&!s.trimStart().startsWith("$$")&&f===1){a[a.length-1]=c+s;continue}}a.push(s)}return a};var Jn=/(!?\[)([^\]]*?)$/,Zn=/(\*\*)([^*]*?)$/,Kn=/(__)([^_]*?)$/,Qn=/(\*\*\*)([^*]*?)$/,eo=/(\*)([^*]*?)$/,to=/(_)([^_]*?)$/,no=/(`)([^`]*?)$/,oo=/(~~)([^~]*?)$/,Me=e=>{let t=(e.match(/```/g)||[]).length;return t>0&&t%2===0&&e.includes(`
`)},ro=e=>{let t=/(!?)\[([^\]]+)\]\(([^)]+)$/,n=e.match(t);if(n){let a=n[1]==="!",r=n[2],i=n[3],l=e.lastIndexOf(`${a?"!":""}[${r}](${i}`),s=e.substring(0,l);return a?s:`${s}[${r}](streamdown:incomplete-link)`}let o=e.match(Jn);if(o){if(o[1].startsWith("!")){let r=e.lastIndexOf(o[1]);return e.substring(0,r)}return`${e}](streamdown:incomplete-link)`}return e},ao=e=>{if(Me(e))return e;let t=e.match(Zn);if(t){let n=t[2];if(!n||/^[\s_~*`]*$/.test(n))return e;let o=e.lastIndexOf(t[1]),r=e.substring(0,o).lastIndexOf(`
`),i=r===-1?0:r+1,l=e.substring(i,o);if(/^[\s]*[-*+][\s]+$/.test(l)&&n.includes(`
`))return e;if((e.match(/\*\*/g)||[]).length%2===1)return`${e}**`}return e},so=e=>{let t=e.match(Kn);if(t){let n=t[2];if(!n||/^[\s_~*`]*$/.test(n))return e;let o=e.lastIndexOf(t[1]),r=e.substring(0,o).lastIndexOf(`
`),i=r===-1?0:r+1,l=e.substring(i,o);if(/^[\s]*[-*+][\s]+$/.test(l)&&n.includes(`
`))return e;if((e.match(/__/g)||[]).length%2===1)return`${e}__`}return e},io=e=>e.split("").reduce((t,n,o)=>{if(n==="*"){let a=e[o-1],r=e[o+1];if(a==="\\")return t;let i=o;for(let s=o-1;s>=0;s--){if(e[s]===`
`){i=s+1;break}if(s===0){i=0;break}}if(e.substring(i,o).trim()===""&&(r===" "||r==="	"))return t;if(a!=="*"&&r!=="*")return t+1}return t},0),lo=e=>{if(Me(e))return e;if(e.match(eo)){let n=-1;for(let r=0;r<e.length;r++)if(e[r]==="*"&&e[r-1]!=="*"&&e[r+1]!=="*"){n=r;break}if(n===-1)return e;let o=e.substring(n+1);if(!o||/^[\s_~*`]*$/.test(o))return e;if(io(e)%2===1)return`${e}*`}return e},on=(e,t)=>{let n=!1,o=!1;for(let a=0;a<e.length&&a<t;a++){if(e[a]==="\\"&&e[a+1]==="$"){a++;continue}e[a]==="$"&&(e[a+1]==="$"?(o=!o,a++,n=!1):o||(n=!n))}return n||o},co=e=>e.split("").reduce((t,n,o)=>{if(n==="_"){let a=e[o-1],r=e[o+1];if(a==="\\"||on(e,o)||a&&r&&/[\p{L}\p{N}_]/u.test(a)&&/[\p{L}\p{N}_]/u.test(r))return t;if(a!=="_"&&r!=="_")return t+1}return t},0),uo=e=>{if(Me(e))return e;if(e.match(to)){let n=-1;for(let r=0;r<e.length;r++)if(e[r]==="_"&&e[r-1]!=="_"&&e[r+1]!=="_"&&e[r-1]!=="\\"&&!on(e,r)){let i=r>0?e[r-1]:"",l=r<e.length-1?e[r+1]:"";if(i&&l&&/[\p{L}\p{N}_]/u.test(i)&&/[\p{L}\p{N}_]/u.test(l))continue;n=r;break}if(n===-1)return e;let o=e.substring(n+1);if(!o||/^[\s_~*`]*$/.test(o))return e;if(co(e)%2===1){let r=e.match(/\n+$/);return r?`${e.slice(0,-r[0].length)}_${r[0]}`:`${e}_`}}return e},mo=(e,t)=>{let n=e.substring(t,t+3)==="```",o=t>0&&e.substring(t-1,t+2)==="```",a=t>1&&e.substring(t-2,t+1)==="```";return n||o||a},po=e=>{let t=0;for(let n=0;n<e.length;n++)e[n]==="`"&&!mo(e,n)&&t++;return t},fo=e=>{if(e.match(/^```[^`\n]*```?$/)&&!e.includes(`
`))return e.endsWith("``")&&!e.endsWith("```")?`${e}\``:e;let n=(e.match(/```/g)||[]).length,o=n%2===1;if(n>0&&n%2===0&&e.includes(`
`)||(e.endsWith("```\n")||e.endsWith("```"))&&n%2===0)return e;let a=e.match(no);if(a&&!o){let r=a[2];if(!r||/^[\s_~*`]*$/.test(r))return e;if(po(e)%2===1)return`${e}\``}return e},ho=e=>{let t=e.match(oo);if(t){let n=t[2];if(!n||/^[\s_~*`]*$/.test(n))return e;if((e.match(/~~/g)||[]).length%2===1)return`${e}~~`}return e};var go=e=>{if((e.match(/\$\$/g)||[]).length%2===0)return e;let n=e.indexOf("$$");return n!==-1&&e.indexOf(`
`,n)!==-1&&!e.endsWith(`
`)?`${e}
$$`:`${e}$$`},bo=e=>{let t=0,n=e.match(/\*+/g)||[];for(let o of n){let a=o.length;a>=3&&(t+=Math.floor(a/3))}return t},wo=e=>{if(Me(e)||/^\*{4,}$/.test(e))return e;let t=e.match(Qn);if(t){let n=t[2];if(!n||/^[\s_~*`]*$/.test(n))return e;if(bo(e)%2===1)return`${e}***`}return e},rn=e=>{if(!e||typeof e!="string")return e;let t=e,n=ro(t);return n.endsWith("](streamdown:incomplete-link)")?n:(t=n,t=wo(t),t=ao(t),t=so(t),t=lo(t),t=uo(t),t=fo(t),t=ho(t),t=go(t),t)};import{jsx as Q}from"react/jsx-runtime";var Po={harden:[No,{allowedImagePrefixes:["*"],allowedLinkPrefixes:["*"],defaultOrigin:void 0,allowDataImages:!0}],raw:Mo,katex:[ko,{errorColor:"var(--color-muted-foreground)"}]},To={gfm:[xo,{}],math:[Co,{singleDollarTextMath:!1}]},$e=xe(["github-light","github-dark"]),Ke=xe(void 0),ke=xe(!0),F=xe({isAnimating:!1}),ln=an(({content:e,shouldParseIncompleteMarkdown:t,...n})=>{let o=sn(()=>typeof e=="string"&&t?rn(e.trim()):e,[e,t]);return Q(vo,{...n,children:o})},(e,t)=>e.content===t.content);ln.displayName="Block";var So=an(({children:e,parseIncompleteMarkdown:t=!0,components:n,rehypePlugins:o=Object.values(Po),remarkPlugins:a=Object.values(To),className:r,shikiTheme:i=["github-light","github-dark"],mermaidConfig:l,controls:s=!0,isAnimating:c=!1,...d})=>{let m=yo(),f=sn(()=>nn(typeof e=="string"?e:""),[e]);return Q($e.Provider,{value:i,children:Q(Ke.Provider,{value:l,children:Q(ke.Provider,{value:s,children:Q(F.Provider,{value:{isAnimating:c},children:Q("div",{className:y("space-y-4",r),children:f.map((h,w)=>Q(ln,{components:{...en,...n},content:h,rehypePlugins:o,remarkPlugins:a,shouldParseIncompleteMarkdown:t,...d},`${m}-block-${w}`))})})})})})},(e,t)=>e.children===t.children&&e.shikiTheme===t.shikiTheme&&e.isAnimating===t.isAnimating);So.displayName="Streamdown";export{ke as ControlsContext,Ke as MermaidConfigContext,$e as ShikiThemeContext,So as Streamdown,F as StreamdownRuntimeContext,Po as defaultRehypePlugins,To as defaultRemarkPlugins};
